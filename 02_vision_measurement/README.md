# ğŸ“ åŸºäºå•ç›®è§†è§‰çš„ç›®æ ‡ç‰©æµ‹é‡è£…ç½®

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†åŸºäºå•ç›®è§†è§‰çš„éæ¥è§¦å¼æµ‹é‡ç³»ç»Ÿï¼Œèƒ½å¤Ÿå‡†ç¡®æµ‹é‡A4çº¸ç›®æ ‡ç‰©çš„è·ç¦»å’Œå‡ ä½•å½¢çŠ¶å°ºå¯¸ã€‚è¯¥é¡¹ç›®å¯¹åº”å…¨å›½å¤§å­¦ç”Ÿç”µå­è®¾è®¡ç«èµ›Cé¢˜è¦æ±‚ã€‚

## æŠ€æœ¯ç‰¹ç‚¹

- **éæ¥è§¦å¼æµ‹é‡**: åŸºäºè®¡ç®—æœºè§†è§‰æŠ€æœ¯
- **é«˜ç²¾åº¦æµ‹é‡**: è·ç¦»ç²¾åº¦Â±2cmï¼Œå°ºå¯¸ç²¾åº¦Â±5%
- **å®æ—¶å¤„ç†**: å•æ¬¡æµ‹é‡æ—¶é—´<5ç§’
- **è‡ªåŠ¨è¯†åˆ«**: æ”¯æŒå¤šç§å‡ ä½•å½¢çŠ¶è‡ªåŠ¨è¯†åˆ«
- **ç•¸å˜æ ¡æ­£**: è‡ªåŠ¨ç›¸æœºç•¸å˜æ ¡æ­£

## æ ¸å¿ƒç®—æ³•

### 1. ç›¸æœºæ ‡å®š
ä½¿ç”¨å¼ æ­£å‹æ ‡å®šæ³•è·å–ç›¸æœºå†…å‚ï¼š
```python
camera_matrix = np.array([
    [fx,  0, cx],
    [ 0, fy, cy],
    [ 0,  0,  1]
])
```

### 2. ç›®æ ‡æ£€æµ‹
- **é¢œè‰²ç©ºé—´è½¬æ¢**: BGR â†’ HSV
- **è¾¹ç¼˜æ£€æµ‹**: é»‘è‰²è¾¹æ¡†è¯†åˆ«
- **è½®å»“è¿‘ä¼¼**: Douglas-Peuckerç®—æ³•
- **å½¢çŠ¶éªŒè¯**: A4çº¸å®½é«˜æ¯”æ£€éªŒ(~0.707)

### 3. è·ç¦»è®¡ç®—
åŸºäºç›¸ä¼¼ä¸‰è§’å½¢åŸç†ï¼š
```python
D = (camera_height * fy) / dy_pixels
```

### 4. å°ºå¯¸æµ‹é‡
- **é€è§†å˜æ¢**: è·å–æ­£è§†å›¾
- **å½¢çŠ¶è¯†åˆ«**: åœ†å½¢ã€ä¸‰è§’å½¢ã€æ­£æ–¹å½¢
- **å°ºå¯¸è®¡ç®—**: åƒç´ åˆ°å®é™…å°ºå¯¸è½¬æ¢

## æ–‡ä»¶è¯´æ˜

```
02_vision_measurement/
â”œâ”€â”€ Distance.py           # ä¸»è¦æµ‹é‡ç®—æ³•
â”œâ”€â”€ Debugæµç¨‹.png        # è°ƒè¯•æµç¨‹å›¾
â”œâ”€â”€ Debugç‰ˆæœ¬.txt        # è°ƒè¯•è¯´æ˜
â”œâ”€â”€ å¯„å­˜å™¨å•å‡»å¸¸æµ‹.txt    # å¯„å­˜å™¨æµ‹è¯•
â”œâ”€â”€ å¯„å­˜å™¨å•æœºå•æµ‹.txt    # å•æœºæµ‹è¯•
â”œâ”€â”€ å¸¸ç”¨å‘½ä»¤.txt         # å¸¸ç”¨å‘½ä»¤å‚è€ƒ
â””â”€â”€ è‘µèŠ±å®å…¸.png        # ä½¿ç”¨æŒ‡å—
```

## ç¯å¢ƒé…ç½®

### Pythonä¾èµ–
```bash
pip install opencv-python>=4.5.0
pip install numpy>=1.19.0
pip install scipy>=1.6.0
pip install imutils>=0.5.4
pip install pytesseract>=0.3.7
```

### ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Windows/Linux/macOS
- **Pythonç‰ˆæœ¬**: 3.7+
- **å†…å­˜**: æœ€ä½4GB RAM
- **æ‘„åƒå¤´**: USBæ‘„åƒå¤´æˆ–å·¥ä¸šç›¸æœº

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬æµ‹é‡
```python
from Distance import VisionMeasurementSystem

# åˆå§‹åŒ–ç³»ç»Ÿ
vms = VisionMeasurementSystem(camera_matrix, dist_coeffs, camera_height)

# è¯»å–å›¾åƒ
image = cv2.imread("target_image.jpg")

# æ‰§è¡Œæµ‹é‡
D, x, shapes = vms.measure(image, debug=True)

print(f"è·ç¦»: {D:.1f}cm, å°ºå¯¸: {x:.1f}cm")
```

### 2. ç›¸æœºæ ‡å®š
```python
# ä½¿ç”¨æ ‡å®šæ¿å›¾åƒè¿›è¡Œæ ‡å®š
ret, mtx, dist, rvecs, tvecs = cv2.calibrateCamera(
    objpoints, imgpoints, gray.shape[::-1], None, None)
```

### 3. è°ƒè¯•æ¨¡å¼
```python
# å¼€å¯è°ƒè¯•æ¨¡å¼æŸ¥çœ‹å¤„ç†è¿‡ç¨‹
debug_info = vms.debug_analysis(image)
```

## æµ‹é‡æµç¨‹

### 1. å›¾åƒé¢„å¤„ç†
```
åŸå§‹å›¾åƒ â†’ ç•¸å˜æ ¡æ­£ â†’ HSVè½¬æ¢ â†’ è¾¹ç¼˜æ£€æµ‹ â†’ å½¢æ€å­¦å¤„ç†
```

### 2. ç›®æ ‡æ£€æµ‹
```
è½®å»“æå– â†’ è½®å»“ç­›é€‰ â†’ å¤šè¾¹å½¢è¿‘ä¼¼ â†’ A4çº¸éªŒè¯ â†’ è§’ç‚¹æ’åº
```

### 3. é€è§†å˜æ¢
```
å››ç‚¹å¯¹åº” â†’ é€è§†çŸ©é˜µ â†’ å›¾åƒå˜æ¢ â†’ æ­£è§†å›¾è·å–
```

### 4. å½¢çŠ¶è¯†åˆ«
```
äºŒå€¼åŒ– â†’ è½®å»“æ£€æµ‹ â†’ å½¢çŠ¶åˆ†ç±» â†’ å°ºå¯¸è®¡ç®—
```

## ç²¾åº¦æŒ‡æ ‡

| æµ‹é‡é¡¹ç›® | ç²¾åº¦æŒ‡æ ‡ | æµ‹è¯•æ¡ä»¶ |
|----------|----------|----------|
| è·ç¦»æµ‹é‡(D) | Â±2cm | è·ç¦»12-18cm |
| è¾¹é•¿æµ‹é‡(x) | Â±5% | æ­£æ–¹å½¢è¾¹é•¿2-10cm |
| åœ†ç›´å¾„æµ‹é‡ | Â±5% | åœ†ç›´å¾„2-10cm |
| ä¸‰è§’å½¢è¾¹é•¿ | Â±5% | ç­‰è¾¹ä¸‰è§’å½¢ |

## å‚æ•°é…ç½®

### ç›¸æœºå‚æ•°
```python
# ç›¸æœºå†…å‚çŸ©é˜µ
camera_matrix = np.array([
    [1.06086502e+03, 0.00000000e+00, 6.44918938e+02],
    [0.00000000e+00, 1.07097676e+03, 3.42131143e+02],
    [0.00000000e+00, 0.00000000e+00, 1.00000000e+00]
])

# ç•¸å˜ç³»æ•°
dist_coeffs = np.array([k1, k2, p1, p2, k3])

# ç›¸æœºé«˜åº¦(cm)
camera_height = 50.0
```

### å›¾åƒå¤„ç†å‚æ•°
```python
# HSVé˜ˆå€¼èŒƒå›´
lower_black = np.array([0, 0, 0])
upper_black = np.array([180, 255, 50])

# A4çº¸å®½é«˜æ¯”èŒƒå›´
aspect_ratio_range = (0.6, 0.8)

# è½®å»“è¿‘ä¼¼ç²¾åº¦
epsilon_factors = [0.01, 0.02, 0.03, 0.04, 0.05]
```

## è°ƒè¯•åŠŸèƒ½

### 1. å¯è§†åŒ–è°ƒè¯•
```python
# æ˜¾ç¤ºå¤„ç†æ­¥éª¤
cv2.imshow("Original", image)
cv2.imshow("Preprocessed", undistorted)
cv2.imshow("Mask", mask)
cv2.imshow("Contours", debug_img)
```

### 2. å‚æ•°åˆ†æ
```python
# è¾“å‡ºè°ƒè¯•ä¿¡æ¯
print(f"æ£€æµ‹åˆ°è½®å»“æ•°é‡: {len(contours)}")
print(f"å®½é«˜æ¯”: {aspect_ratio:.3f}")
print(f"é¢ç§¯: {area:.0f}pxÂ²")
```

### 3. æ€§èƒ½ç›‘æ§
```python
import time
start_time = time.time()
# æµ‹é‡ä»£ç 
end_time = time.time()
print(f"å¤„ç†æ—¶é—´: {end_time - start_time:.2f}ç§’")
```

## å¸¸è§é—®é¢˜

### 1. æ— æ³•æ£€æµ‹åˆ°A4çº¸
**åŸå› **: å…‰ç…§ä¸å‡ã€å¯¹æ¯”åº¦ä¸å¤Ÿ
**è§£å†³**: 
- è°ƒæ•´ç…§æ˜æ¡ä»¶
- ä¿®æ”¹HSVé˜ˆå€¼èŒƒå›´
- æ£€æŸ¥ç›¸æœºç„¦è·

### 2. æµ‹é‡ç²¾åº¦ä¸è¶³
**åŸå› **: ç›¸æœºæ ‡å®šä¸å‡†ç¡®
**è§£å†³**:
- é‡æ–°è¿›è¡Œç›¸æœºæ ‡å®š
- ä½¿ç”¨æ›´å¤šæ ‡å®šå›¾åƒ
- æ£€æŸ¥æ ‡å®šæ¿è´¨é‡

### 3. å½¢çŠ¶è¯†åˆ«é”™è¯¯
**åŸå› **: è½®å»“è¿‘ä¼¼å‚æ•°ä¸å½“
**è§£å†³**:
- è°ƒæ•´epsilonå‚æ•°
- æ”¹å–„å›¾åƒè´¨é‡
- ä¼˜åŒ–é¢„å¤„ç†ç®—æ³•

## æ‰©å±•åŠŸèƒ½

### 1. å¤šç›®æ ‡æµ‹é‡
```python
# æ”¯æŒåŒæ—¶æµ‹é‡å¤šä¸ªç›®æ ‡
for shape in shapes:
    size = measure_size(shape)
    print(f"{shape['type']}: {size}cm")
```

### 2. å®æ—¶æµ‹é‡
```python
# æ‘„åƒå¤´å®æ—¶æµ‹é‡
cap = cv2.VideoCapture(0)
while True:
    ret, frame = cap.read()
    D, x, shapes = vms.measure(frame)
    # æ˜¾ç¤ºç»“æœ
```

### 3. æ•°æ®å¯¼å‡º
```python
# æµ‹é‡ç»“æœä¿å­˜
results = {
    'timestamp': time.time(),
    'distance': D,
    'size': x,
    'shape_type': target_shape['shape']
}
with open('results.json', 'w') as f:
    json.dump(results, f)
```

## å‚è€ƒèµ„æ–™

- [OpenCVå®˜æ–¹æ–‡æ¡£](https://docs.opencv.org/)
- [ç›¸æœºæ ‡å®šç†è®º](https://docs.opencv.org/master/dc/dbb/tutorial_py_calibration.html)
- [é€è§†å˜æ¢åŸç†](https://docs.opencv.org/master/da/d6e/tutorial_py_geometric_transformations.html)

---
**æ³¨æ„**: ä½¿ç”¨å‰è¯·ç¡®ä¿ç›¸æœºå·²æ­£ç¡®æ ‡å®šï¼Œå¹¶æ ¹æ®å®é™…ä½¿ç”¨ç¯å¢ƒè°ƒæ•´å‚æ•°ã€‚
